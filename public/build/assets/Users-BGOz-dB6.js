import{d as $,r as n,f as T,c as w,a as c,u as E,h as F,w as f,b as o,i as k,A as z,e as b,m as D,t as y,F as N,s as m,x as p,_ as V}from"./app-Dto5FeMA.js";import{_ as I}from"./AppLayout.vue_vue_type_script_setup_true_lang-BhHeXh4H.js";import{M}from"./Modal-Dtu2lvpR.js";import{_ as R}from"./UserForm.vue_vue_type_script_setup_true_lang-DtXCqgEI.js";import{_ as Y}from"./UserTable.vue_vue_type_script_setup_true_lang-BAAY6Cx2.js";import{d as q}from"./index-BcgMG_W3.js";import"./index-CMWG4mbA.js";const P={class:"row"},j={class:"col-12"},G={class:"d-flex align-items-center"},H={class:"me-2",style:{"font-size":"18px"}},J=$({__name:"Users",props:{users:{},states:{}},setup(v){const g=[{title:"Dashboard",href:q().url},{title:"Users",href:"/users"}],d=n(!1),a=n(null),_=n(!1),l=n({}),x=n(null),i=n({show:!1,message:"",type:"success"}),e=T({name:"",username:"",first_name:"",middle_name:"",last_name:"",mobile:"",email:"",company_name:"",birth_date:"",state_id:"",city_id:"",is_active:!0,password:""}),u=()=>{e.name="",e.username="",e.first_name="",e.middle_name="",e.last_name="",e.mobile="",e.email="",e.company_name="",e.birth_date="",e.state_id="",e.city_id="",e.is_active=!0,e.password="",l.value={},a.value=null,d.value=!1},t=(s,r="success")=>{i.value={show:!0,message:s,type:r},setTimeout(()=>{i.value.show=!1},3e3)},U=s=>{a.value=s,e.name=s.name,e.username=s.username,e.first_name=s.first_name,e.middle_name=s.middle_name||"",e.last_name=s.last_name,e.mobile=s.mobile||"",e.email=s.email,e.company_name=s.company_name||"",e.birth_date=s.birth_date||"",e.state_id=s.state_id?.toString()||"",e.city_id=s.city_id?.toString()||"",e.is_active=s.is_active,e.password="",l.value={},d.value=!0},C=()=>{u(),d.value=!0},h=async()=>{_.value=!0,l.value={};try{const s={name:e.name,username:e.username,first_name:e.first_name,last_name:e.last_name,middle_name:e.middle_name||null,mobile:e.mobile||null,email:e.email,company_name:e.company_name||null,birth_date:e.birth_date||null,state_id:e.state_id?parseInt(e.state_id):null,city_id:e.city_id?parseInt(e.city_id):null,is_active:e.is_active};e.password&&(s.password=e.password),a.value?(s.password||delete s.password,await m.put(`/users/${a.value.id}`,s),t("User updated successfully!")):(await m.post("/users",s),t("User created successfully!")),u(),p.reload()}catch(s){s.response?.status===422?(l.value=s.response.data.errors,t("Please fix the validation errors.","error")):(console.error("Error saving user:",s),t("An error occurred while saving the user.","error"))}finally{_.value=!1}},B=async s=>{if((await window.Swal.fire({title:"Are you sure?",text:`You are about to delete the user "${s.name}". This action cannot be undone!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)try{await m.delete(`/users/${s.id}`),t("User deleted successfully!"),p.reload()}catch(A){console.error("Error deleting user:",A),t("An error occurred while deleting the user.","error")}},S=async s=>{try{await m.patch(`/users/${s.id}/toggle-active`),t(`User ${s.is_active?"deactivated":"activated"} successfully!`),p.reload()}catch(r){console.error("Error toggling user status:",r),t("An error occurred while updating user status.","error")}};return(s,r)=>(b(),w(N,null,[c(E(F),{title:"Users Management"}),c(I,{breadcrumbs:g},{default:f(()=>[o("div",P,[o("div",j,[c(Y,{users:v.users,onEdit:U,onDelete:B,onToggleActive:S},{"header-action":f(()=>[o("button",{onClick:C,class:"btn btn-primary btn-sm btn-default btn-squared text-capitalize lh-normal px-3 py-2"},[...r[0]||(r[0]=[o("span",{"data-feather":"plus",class:"me-1"},null,-1),z(" Add User ",-1)])])]),_:1},8,["users"]),c(M,{show:d.value,title:a.value?"Edit User":"Create User",loading:_.value,"submit-label":a.value?"Update User":"Create User",size:"xl",onClose:u,onSubmit:h},{default:f(()=>[c(R,{ref_key:"userFormRef",ref:x,form:e,states:v.states,"editing-user":a.value,errors:l.value,onSubmit:h,onCancel:u},null,8,["form","states","editing-user","errors"])]),_:1},8,["show","title","loading","submit-label"])])]),i.value.show?(b(),w("div",{key:0,class:D(["toast-notification",i.value.type==="success"?"toast-success":"toast-error"]),style:{position:"fixed",top:"20px",right:"20px","z-index":"9999","min-width":"300px",padding:"12px 16px","border-radius":"8px",color:"white","font-weight":"500","box-shadow":"0 4px 12px rgba(0,0,0,0.15)"}},[o("div",G,[o("span",H,y(i.value.type==="success"?"✅":"❌"),1),o("span",null,y(i.value.message),1)])],2)):k("",!0)]),_:1})],64))}}),se=V(J,[["__scopeId","data-v-1fd41e79"]]);export{se as default};
