import{d as H,g as A,r as f,f as Q,O as E,s as C,o as X,n as k,c as y,a as h,u as Y,h as Z,w as x,b as s,i as $,t as F,k as ee,e as p,j as te,z as O,K as ie,m as ae,F as re,x as _e,_ as oe}from"./app-bTN5IIvP.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-HOX8K8TC.js";import{_ as ne}from"./StepIndicator.vue_vue_type_script_setup_true_lang-DdPNet8i.js";import{_ as le}from"./BuilderInformation.vue_vue_type_script_setup_true_lang-D76PYqoS.js";import{_ as de}from"./ProjectInformation.vue_vue_type_script_setup_true_lang-TM9zi6Iy.js";import{_ as ce}from"./ContactDetails.vue_vue_type_script_setup_true_lang-pdXZfyRb.js";import{_ as ue}from"./ChoiseSelection.vue_vue_type_script_setup_true_lang-B2vxDGQb.js";import{_ as fe}from"./TowerDetailsSection.vue_vue_type_script_setup_true_lang-P7T1IGVL.js";import pe from"./ParkingAndAmenities-h2ww-3Kw.js";import{_ as me}from"./RetailForm.vue_vue_type_script_setup_true_lang-B39a5zDI.js";import"./plus-DKE-Y7Ql.js";import"./createLucideIcon-D17MpstW.js";import"./x-DXGu7dT6.js";const ge={class:"row"},he={class:"col-12"},be={class:"card mb-4 mt-4"},ye={class:"card-header color-dark fw-500"},ve={class:"mb-0"},we={class:"card-body"},ke={key:0,class:"d-flex flex-column align-items-center justify-content-center",style:{"min-height":"400px"}},$e={class:"row"},je={class:"col-md-3 col-lg-2"},Se={class:"col-md-9 col-lg-10"},Pe={key:0},Ee={key:1},Ce={key:2},ze={class:"d-flex justify-content-end gap-2 mt-4"},Te=["disabled"],Fe={class:"d-flex align-items-center"},Ae={class:"me-2",style:{"font-size":"18px"}},Ne=H({__name:"CreateProject",props:{project:{},builders:{},states:{},measurementUnits:{},restrictedUserOptions:{},constructionTypes:{},amenities:{}},setup(u){const b=u,c=A(()=>!!b.project),q=A(()=>[{title:"Dashboard",href:"/dashboard"},{title:c.value?"Edit Project":"Create Project",href:c.value?`/projects/${b.project?.id}/edit`:"/projects/create"}]),n=f(1),j=f(!1),o=f({}),S=f([]),m=f([]),z=f(!1),T=f(!1),v=f({show:!1,message:"",type:"success"}),g=f([{id:1,name:"",mobile:"",email:"",designation:""}]);let N=2;const t=Q({builder_id:"",builder_website:"",project_name:"",address:"",state_id:"",city_id:"",locality_id:"",pincode:"",location_link:"",land_size:"",measurement_unit_id:"",rera_no:"",project_status:"",restricted_user_ids:[],construction_type_id:"",category_id:"",sub_category_id:"",no_of_towers:"",no_of_floors:"",total_units:"",no_of_unit_each_tower:"",no_of_lift:"",front_road_width:"",front_road_width_measurement_unit_id:"",washroom:"Private",two_road_corner:!1,towers_different_specification:!1,retail_unit_details:[],tower_details:[{tower_name:"",saleable_area_from:"",saleable_area_to:"",saleable_area_unit_id:"",ceiling_height:"",ceiling_height_unit_id:"",carpet_area_from:"",carpet_area_to:"",carpet_area_unit_id:"",builtup_area_from:"",builtup_area_to:"",builtup_area_unit_id:"",show_carpet_area:!1,show_builtup_area:!1}],free_allotted_parking_four_wheeler:!1,free_allotted_parking_two_wheeler:!1,available_for_purchase:!1,no_of_parking:"",total_floor_for_parking:"1",basement_parking:[{floor_no:"",ev_charging_point:"",hydraulic_parking:"",height_of_basement:"",height_of_basement_unit_id:""}],amenity_ids:[],document_uploads:[],brochure_file:null,existing_brochure_file:null,brochure_deleted:!1,remark:""}),w=(e,i="success")=>{v.value={show:!0,message:e,type:i},setTimeout(()=>{v.value.show=!1},3e3)},D=()=>{g.value.push({id:N++,name:"",mobile:"",email:"",designation:""})},V=e=>{g.value.length>1&&(g.value=g.value.filter(i=>i.id!==e))};E(()=>t.no_of_towers,e=>{if(!t.towers_different_specification)return;const i=parseInt(e)||1,_=t.tower_details.length;if(i>_)for(let a=_;a<i;a++)t.tower_details.push({tower_name:"",saleable_area_from:"",saleable_area_to:"",saleable_area_unit_id:"",ceiling_height:"",ceiling_height_unit_id:"",carpet_area_from:"",carpet_area_to:"",carpet_area_unit_id:"",builtup_area_from:"",builtup_area_to:"",builtup_area_unit_id:"",show_carpet_area:!1,show_builtup_area:!1});else i<_&&i>0&&(t.tower_details=t.tower_details.slice(0,i));(i===0||!e)&&t.tower_details.length===0&&t.tower_details.push({tower_name:"",saleable_area_from:"",saleable_area_to:"",saleable_area_unit_id:"",ceiling_height:"",ceiling_height_unit_id:"",carpet_area_from:"",carpet_area_to:"",carpet_area_unit_id:"",builtup_area_from:"",builtup_area_to:"",builtup_area_unit_id:"",show_carpet_area:!1,show_builtup_area:!1})},{immediate:!1}),E(()=>t.towers_different_specification,e=>{if(!e)t.tower_details.length>1&&(t.tower_details=[t.tower_details[0]]);else{const i=parseInt(t.no_of_towers)||1,_=t.tower_details.length;if(i>_)for(let a=_;a<i;a++)t.tower_details.push({tower_name:"",saleable_area_from:"",saleable_area_to:"",saleable_area_unit_id:"",ceiling_height:"",ceiling_height_unit_id:"",carpet_area_from:"",carpet_area_to:"",carpet_area_unit_id:"",builtup_area_from:"",builtup_area_to:"",builtup_area_unit_id:"",show_carpet_area:!1,show_builtup_area:!1});else i<_&&i>0&&(t.tower_details=t.tower_details.slice(0,i));t.tower_details.length===0&&t.tower_details.push({tower_name:"",saleable_area_from:"",saleable_area_to:"",saleable_area_unit_id:"",ceiling_height:"",ceiling_height_unit_id:"",carpet_area_from:"",carpet_area_to:"",carpet_area_unit_id:"",builtup_area_from:"",builtup_area_to:"",builtup_area_unit_id:"",show_carpet_area:!1,show_builtup_area:!1})}},{immediate:!1}),E(()=>t.state_id,async e=>{if(!z.value)if(e)try{const i=await C.get(`/states/${e}/cities`);S.value=i.data,t.city_id="",t.locality_id="",t.pincode="",m.value=[]}catch(i){console.error("Error loading cities:",i),S.value=[]}else S.value=[],t.city_id="",t.locality_id="",t.pincode="",m.value=[]}),E(()=>t.city_id,async e=>{if(!z.value)if(e)try{const i=await C.get(`/cities/${e}/localities`);m.value=i.data,t.locality_id="",t.pincode=""}catch(i){console.error("Error loading localities:",i),m.value=[]}else m.value=[],t.locality_id="",t.pincode=""}),E(()=>t.locality_id,e=>{if(e){const i=m.value.find(_=>_.id===Number(e));i&&i.zip_code&&(t.pincode=i.zip_code)}else t.pincode=""});const P=()=>{o.value={};let e=!0;if((!t.builder_id||t.builder_id==="")&&(o.value.builder_id=["Builder Name is required"],e=!1),(!t.project_name||t.project_name.trim()==="")&&(o.value.project_name=["Project Name is required"],e=!1),(!t.locality_id||t.locality_id==="")&&(o.value.locality_id=["Locality is required"],e=!1),g.value.forEach((i,_)=>{(!i.name||i.name.trim()==="")&&(o.value[`contacts.${_}.name`]||(o.value[`contacts.${_}.name`]=[]),o.value[`contacts.${_}.name`].push("Name is required"),e=!1),(!i.mobile||i.mobile.trim()==="")&&(o.value[`contacts.${_}.mobile`]||(o.value[`contacts.${_}.mobile`]=[]),o.value[`contacts.${_}.mobile`].push("Mobile is required"),e=!1),i.mobile&&i.mobile.trim()!==""&&(/^[0-9]{10}$/.test(i.mobile.trim())||(o.value[`contacts.${_}.mobile`]||(o.value[`contacts.${_}.mobile`]=[]),o.value[`contacts.${_}.mobile`].push("Mobile must be 10 digits"),e=!1)),i.email&&i.email.trim()!==""&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email.trim())||(o.value[`contacts.${_}.email`]||(o.value[`contacts.${_}.email`]=[]),o.value[`contacts.${_}.email`].push("Please enter a valid email address"),e=!1))}),t.builder_website&&t.builder_website.trim()!=="")try{new URL(t.builder_website)}catch{o.value.builder_website=["Please enter a valid URL"],e=!1}if(t.location_link&&t.location_link.trim()!=="")try{new URL(t.location_link)}catch{o.value.location_link=["Please enter a valid URL"],e=!1}return e},B=()=>{const e=Object.keys(o.value);if(e.length===0)return 1;const i=["builder_id","builder_website","project_name","address","state_id","city_id","locality_id","pincode","location_link","land_size","measurement_unit_id","rera_no","project_status","restricted_user_ids"],_=["construction_type_id","category_id","sub_category_id","sub_category_ids","no_of_towers","no_of_floors","total_units","no_of_unit_each_tower","no_of_lift","front_road_width","front_road_width_measurement_unit_id","washroom","two_road_corner","retail_unit_details","tower_details"],a=["free_allotted_parking_four_wheeler","free_allotted_parking_two_wheeler","available_for_purchase","no_of_parking","total_floor_for_parking","basement_parking","amenities","documents","remark","brochure_file"],r=e.some(d=>d.startsWith("contacts.")),l=e[0];return i.includes(l)||r?1:_.includes(l)||e.some(d=>d.startsWith("tower_details.")||d.startsWith("retail_unit_details."))?2:a.includes(l)||e.some(d=>d.startsWith("basement_parking.")||d.startsWith("documents."))?3:1},U=()=>{const e=B();n.value=e,setTimeout(()=>{const i=document.querySelector(".is-invalid");i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100)},L=async()=>{if(j.value=!0,o.value={},!P()){j.value=!1,w("Please fix the validation errors before submitting.","error"),U();return}try{const e=new FormData;e.append("builder_id",t.builder_id),t.builder_website&&e.append("builder_website",t.builder_website),e.append("project_name",t.project_name),t.address&&e.append("address",t.address),t.state_id&&e.append("state_id",t.state_id),t.city_id&&e.append("city_id",t.city_id),e.append("locality_id",t.locality_id),t.pincode&&e.append("pincode",t.pincode),t.location_link&&e.append("location_link",t.location_link),t.land_size&&e.append("land_size",t.land_size),t.measurement_unit_id&&e.append("measurement_unit_id",t.measurement_unit_id),t.rera_no&&e.append("rera_no",t.rera_no),t.project_status&&e.append("project_status",t.project_status),t.restricted_user_ids&&t.restricted_user_ids.length>0&&t.restricted_user_ids.forEach(a=>{e.append("restricted_user_ids[]",String(a))}),g.value.forEach((a,r)=>{e.append(`contacts[${r}][name]`,a.name),e.append(`contacts[${r}][mobile]`,a.mobile),a.email&&e.append(`contacts[${r}][email]`,a.email),a.designation&&e.append(`contacts[${r}][designation]`,a.designation)}),e.append("construction_type_id",t.construction_type_id),e.append("category_id",t.category_id),t.sub_category_id&&(Array.isArray(t.sub_category_id)?t.sub_category_id.forEach(a=>{e.append("sub_category_ids[]",a)}):e.append("sub_category_id",t.sub_category_id)),t.no_of_towers&&e.append("no_of_towers",t.no_of_towers),t.no_of_floors&&e.append("no_of_floors",t.no_of_floors),t.total_units&&e.append("total_units",t.total_units),t.no_of_unit_each_tower&&e.append("no_of_unit_each_tower",t.no_of_unit_each_tower),t.no_of_lift&&e.append("no_of_lift",t.no_of_lift),t.front_road_width&&e.append("front_road_width",t.front_road_width),t.front_road_width_measurement_unit_id&&e.append("front_road_width_measurement_unit_id",t.front_road_width_measurement_unit_id),t.washroom&&e.append("washroom",t.washroom),e.append("two_road_corner",t.two_road_corner?"1":"0"),e.append("towers_different_specification",t.towers_different_specification?"1":"0"),t.category_id==="2"&&t.retail_unit_details&&t.retail_unit_details.length>0&&t.retail_unit_details.forEach((a,r)=>{a.tower_name&&e.append(`retail_unit_details[${r}][tower_name]`,a.tower_name),a.sub_category_id&&e.append(`retail_unit_details[${r}][sub_category_id]`,a.sub_category_id),a.size_from&&e.append(`retail_unit_details[${r}][size_from]`,a.size_from),a.size_to&&e.append(`retail_unit_details[${r}][size_to]`,a.size_to),a.size_unit_id&&e.append(`retail_unit_details[${r}][size_unit_id]`,a.size_unit_id),a.front_opening&&e.append(`retail_unit_details[${r}][front_opening]`,a.front_opening),a.front_opening_unit_id&&e.append(`retail_unit_details[${r}][front_opening_unit_id]`,a.front_opening_unit_id),a.no_of_unit_each_floor&&e.append(`retail_unit_details[${r}][no_of_unit_each_floor]`,a.no_of_unit_each_floor),a.ceiling_height&&e.append(`retail_unit_details[${r}][ceiling_height]`,a.ceiling_height),a.ceiling_height_unit_id&&e.append(`retail_unit_details[${r}][ceiling_height_unit_id]`,a.ceiling_height_unit_id)}),t.tower_details&&t.tower_details.length>0&&t.tower_details.forEach((a,r)=>{a.tower_name&&e.append(`tower_details[${r}][tower_name]`,a.tower_name),a.saleable_area_from&&e.append(`tower_details[${r}][saleable_area_from]`,a.saleable_area_from),a.saleable_area_to&&e.append(`tower_details[${r}][saleable_area_to]`,a.saleable_area_to),a.saleable_area_unit_id&&e.append(`tower_details[${r}][saleable_area_unit_id]`,a.saleable_area_unit_id),a.ceiling_height&&e.append(`tower_details[${r}][ceiling_height]`,a.ceiling_height),a.ceiling_height_unit_id&&e.append(`tower_details[${r}][ceiling_height_unit_id]`,a.ceiling_height_unit_id),e.append(`tower_details[${r}][show_carpet_area]`,a.show_carpet_area?"1":"0"),a.carpet_area_from&&e.append(`tower_details[${r}][carpet_area_from]`,a.carpet_area_from),a.carpet_area_to&&e.append(`tower_details[${r}][carpet_area_to]`,a.carpet_area_to),a.carpet_area_unit_id&&e.append(`tower_details[${r}][carpet_area_unit_id]`,a.carpet_area_unit_id),e.append(`tower_details[${r}][show_builtup_area]`,a.show_builtup_area?"1":"0"),a.builtup_area_from&&e.append(`tower_details[${r}][builtup_area_from]`,a.builtup_area_from),a.builtup_area_to&&e.append(`tower_details[${r}][builtup_area_to]`,a.builtup_area_to),a.builtup_area_unit_id&&e.append(`tower_details[${r}][builtup_area_unit_id]`,a.builtup_area_unit_id)}),e.append("free_allotted_parking_four_wheeler",t.free_allotted_parking_four_wheeler?"1":"0"),e.append("free_allotted_parking_two_wheeler",t.free_allotted_parking_two_wheeler?"1":"0"),e.append("available_for_purchase",t.available_for_purchase?"1":"0"),t.no_of_parking&&e.append("no_of_parking",t.no_of_parking),t.total_floor_for_parking&&e.append("total_floor_for_parking",t.total_floor_for_parking),t.basement_parking&&t.basement_parking.length>0&&t.basement_parking.forEach((a,r)=>{a.floor_no&&e.append(`basement_parking[${r}][floor_no]`,a.floor_no),a.ev_charging_point&&e.append(`basement_parking[${r}][ev_charging_point]`,a.ev_charging_point),a.hydraulic_parking&&e.append(`basement_parking[${r}][hydraulic_parking]`,a.hydraulic_parking),a.height_of_basement&&e.append(`basement_parking[${r}][height_of_basement]`,a.height_of_basement),a.height_of_basement_unit_id&&e.append(`basement_parking[${r}][height_of_basement_unit_id]`,a.height_of_basement_unit_id)}),t.amenity_ids&&t.amenity_ids.length>0&&t.amenity_ids.forEach(a=>{e.append("amenity_ids[]",a)}),t.document_uploads&&t.document_uploads.length>0&&t.document_uploads.forEach((a,r)=>{a.category&&e.append(`document_uploads[${r}][category]`,a.category),a.files&&a.files.length>0&&a.files.forEach((l,d)=>{e.append(`document_uploads[${r}][files][${d}]`,l)})}),t.brochure_file?e.append("brochure_file",t.brochure_file):c.value&&t.brochure_deleted&&e.append("delete_brochure","1"),t.remark&&e.append("remark",t.remark);const i=c.value?`/projects/${b.project?.id}`:"/projects";c.value&&e.append("_method","PUT"),(await C.post(i,e,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(w(c.value?"Project updated successfully!":"Project created successfully!","success"),setTimeout(()=>{_e.visit("/projects")},2500))}catch(e){console.error("Error creating project:",e),j.value=!1,e.response?.status===422&&e.response?.data?.errors?(o.value=e.response.data.errors,w("Please fix the validation errors before submitting.","error"),U()):w(e.response?.data?.message||(c.value?"Failed to update project. Please try again.":"Failed to create project. Please try again."),"error")}},I=()=>{if(n.value===1){if(!P()){w("Please fix the validation errors before proceeding.","error"),setTimeout(()=>{const e=document.querySelector(".is-invalid");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100);return}n.value=2}else if(n.value===2){o.value={};let e=!1;if(t.construction_type_id||(o.value.construction_type_id=["Please select a construction type"],e=!0),t.category_id||(o.value.category_id=["Please select a category"],e=!0),t.category_id){const i=b.constructionTypes.find(_=>_.id===Number(t.construction_type_id));if(i){const _=i.categories?.find(a=>a.id===Number(t.category_id));_&&_.sub_categories&&_.sub_categories.length>0&&(t.category_id==="2"?(!Array.isArray(t.sub_category_id)||t.sub_category_id.length===0)&&(o.value.sub_category_id=["Please select at least one sub-category"],e=!0):t.sub_category_id||(o.value.sub_category_id=["Please select a sub-category"],e=!0))}}if(e){w("Please fix the validation errors before proceeding.","error"),setTimeout(()=>{const i=document.querySelector(".is-invalid");i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100);return}n.value=3}else n.value===3&&L()},M=()=>{n.value>1&&n.value--},W=A(()=>{if(!t.construction_type_id||!t.category_id||t.category_id!=="2")return[];const e=b.constructionTypes.find(_=>_.id===Number(t.construction_type_id));if(!e||!e.categories)return[];const i=e.categories.find(_=>_.id===Number(t.category_id));return!i||!i.sub_categories?[]:Array.isArray(t.sub_category_id)&&t.sub_category_id.length>0?i.sub_categories.filter(_=>t.sub_category_id.includes(String(_.id))):[]}),K=async()=>{if(!b.project)return;z.value=!0;const e=b.project;if(t.builder_id=String(e.builder_id||""),t.builder_website=e.builder_website||"",t.project_name=e.project_name||"",t.address=e.address||"",t.pincode=e.pincode||"",t.location_link=e.location_link||"",t.land_size=e.land_size||"",t.measurement_unit_id=e.measurement_unit_id?String(e.measurement_unit_id):"",t.rera_no=e.rera_no||"",t.project_status=e.project_status||"",t.restricted_user_ids=e.restricted_user_ids||[],t.construction_type_id=e.construction_type_id?String(e.construction_type_id):"",t.category_id=e.category_id?String(e.category_id):"",e.sub_category_ids)try{const i=typeof e.sub_category_ids=="string"?JSON.parse(e.sub_category_ids):e.sub_category_ids;t.sub_category_id=Array.isArray(i)?i.map(String):[]}catch{t.sub_category_id=[]}else e.sub_category_id?t.sub_category_id=String(e.sub_category_id):t.sub_category_id="";if(t.no_of_towers=e.no_of_towers||"",t.no_of_floors=e.no_of_floors||"",t.total_units=e.total_units||"",t.no_of_unit_each_tower=e.no_of_unit_each_tower||"",t.no_of_lift=e.no_of_lift||"",t.front_road_width=e.front_road_width||"",t.front_road_width_measurement_unit_id=e.front_road_width_measurement_unit_id?String(e.front_road_width_measurement_unit_id):"",t.washroom=e.washroom||"Private",t.two_road_corner=e.two_road_corner||!1,t.towers_different_specification=e.towers_different_specification||!1,e.retail_unit_details)try{const i=typeof e.retail_unit_details=="string"?JSON.parse(e.retail_unit_details):e.retail_unit_details;t.retail_unit_details=Array.isArray(i)?i:[]}catch{t.retail_unit_details=[]}else t.retail_unit_details=[];if(t.free_allotted_parking_four_wheeler=e.free_allotted_parking_four_wheeler||!1,t.free_allotted_parking_two_wheeler=e.free_allotted_parking_two_wheeler||!1,t.available_for_purchase=e.available_for_purchase||!1,t.no_of_parking=e.no_of_parking||"",t.total_floor_for_parking=e.total_floor_for_parking||"1",t.remark=e.remark||"",t.existing_brochure_file=e.brochure_file||null,e.state_id)try{const i=await C.get(`/states/${e.state_id}/cities`);if(S.value=i.data,await k(),t.state_id=e.state_id?String(e.state_id):"",e.city_id)try{const _=await C.get(`/cities/${e.city_id}/localities`);m.value=_.data,await k(),t.city_id=e.city_id?String(e.city_id):"",t.locality_id=e.locality_id?String(e.locality_id):""}catch(_){console.error("Error loading localities:",_),t.city_id=e.city_id?String(e.city_id):"",t.locality_id=e.locality_id?String(e.locality_id):""}else t.city_id="",t.locality_id=e.locality_id?String(e.locality_id):""}catch(i){console.error("Error loading cities:",i),t.state_id=e.state_id?String(e.state_id):"",t.city_id=e.city_id?String(e.city_id):"",t.locality_id=e.locality_id?String(e.locality_id):""}else t.state_id="",t.city_id="",t.locality_id=e.locality_id?String(e.locality_id):"";if(await k(),z.value=!1,await k(),e.contacts&&e.contacts.length>0&&(g.value=e.contacts.map(i=>({id:i.id||N++,name:i.name||"",mobile:i.mobile||"",email:i.email||"",designation:i.designation||""}))),e.tower_details&&e.tower_details.length>0&&(t.tower_details=e.tower_details.map(i=>({tower_name:i.tower_name||"",saleable_area_from:i.saleable_area_from||"",saleable_area_to:i.saleable_area_to||"",saleable_area_unit_id:i.saleable_area_unit_id?String(i.saleable_area_unit_id):"",ceiling_height:i.ceiling_height||"",ceiling_height_unit_id:i.ceiling_height_unit_id?String(i.ceiling_height_unit_id):"",carpet_area_from:i.carpet_area_from||"",carpet_area_to:i.carpet_area_to||"",carpet_area_unit_id:i.carpet_area_unit_id?String(i.carpet_area_unit_id):"",builtup_area_from:i.builtup_area_from||"",builtup_area_to:i.builtup_area_to||"",builtup_area_unit_id:i.builtup_area_unit_id?String(i.builtup_area_unit_id):"",show_carpet_area:i.show_carpet_area||!1,show_builtup_area:i.show_builtup_area||!1}))),e.basement_parking&&e.basement_parking.length>0&&(t.basement_parking=e.basement_parking.map(i=>({floor_no:i.floor_no||"",ev_charging_point:i.ev_charging_point||"",hydraulic_parking:i.hydraulic_parking||"",height_of_basement:i.height_of_basement||"",height_of_basement_unit_id:i.height_of_basement_unit_id?String(i.height_of_basement_unit_id):""}))),e.amenities&&e.amenities.length>0&&(t.amenity_ids=e.amenities.map(i=>String(i.id))),e.documents&&e.documents.length>0){const i=[...e.documents].sort((r,l)=>{const d=(r.category||"Other").toLowerCase(),R=(l.category||"Other").toLowerCase();if(d!==R)return d.localeCompare(R);const G=new Date(r.created_at||0).getTime(),J=new Date(l.created_at||0).getTime();return G-J}),_=new Map;i.forEach(r=>{const l=r.category||"Other";_.has(l)?_.get(l).existing_documents.push({id:r.id,file_path:r.file_path,file_name:r.file_name}):_.set(l,{id:r.id,category:l,files:[],uploaded_files:[],existing_documents:[{id:r.id,file_path:r.file_path,file_name:r.file_name}]})});const a=Array.from(_.values());t.document_uploads=a}else t.document_uploads=[{id:1,category:"",files:[],uploaded_files:[]}]};return X(async()=>{c.value&&(T.value=!0);try{if(c.value&&await K(),await k(),typeof window.$<"u"&&window.$.fn.select2){const e=window.$("#restricted_user_ids");e.length&&(e.select2({placeholder:"Select Restricted Users",allowClear:!0,width:"100%"}),t.restricted_user_ids&&t.restricted_user_ids.length>0&&e.val(t.restricted_user_ids.map(i=>String(i))).trigger("change"),e.on("change",function(){const i=window.$(this).val()||[];t.restricted_user_ids=Array.isArray(i)?i.map(_=>_):i?[i]:[]}))}await k(),await new Promise(e=>setTimeout(e,100))}finally{T.value=!1}}),(e,i)=>(p(),y(re,null,[h(Y(Z),{title:c.value?"Edit Project":"Create Project"},null,8,["title"]),h(se,{breadcrumbs:q.value},{default:x(()=>[s("div",ge,[s("div",he,[s("div",be,[s("div",ye,[s("h4",ve,F(c.value?"Edit Project":"Create Project"),1)]),s("div",we,[T.value?(p(),y("div",ke,[...i[1]||(i[1]=[s("div",{class:"atbd-spin-dots spin-lg"},[s("span",{class:"spin-dot badge-dot dot-primary"}),s("span",{class:"spin-dot badge-dot dot-primary"}),s("span",{class:"spin-dot badge-dot dot-primary"}),s("span",{class:"spin-dot badge-dot dot-primary"})],-1),s("p",{class:"text-dark mt-3 mb-0 fw-medium"},"Loading project data...",-1)])])):$("",!0),ee(s("div",null,[s("div",$e,[s("div",je,[h(ne,{"current-step":n.value},null,8,["current-step"])]),s("div",Se,[s("form",{onSubmit:te(L,["prevent"])},[n.value===1?(p(),y("div",Pe,[h(le,{builders:u.builders,form:t,errors:o.value,"validate-form":P},null,8,["builders","form","errors"]),h(de,{states:u.states,cities:S.value,localities:m.value,"measurement-units":u.measurementUnits,form:t,errors:o.value,"validate-form":P},null,8,["states","cities","localities","measurement-units","form","errors"]),h(ce,{"restricted-user-options":u.restrictedUserOptions,contacts:g.value,form:t,errors:o.value,"validate-form":P,"add-contact":D,"remove-contact":V},null,8,["restricted-user-options","contacts","form","errors"])])):$("",!0),n.value===2?(p(),y("div",Ee,[h(ue,{"construction-types":u.constructionTypes,"model-value":{construction_type_id:t.construction_type_id,category_id:t.category_id,sub_category_id:t.sub_category_id},errors:o.value,"show-ids":!0,"onUpdate:modelValue":i[0]||(i[0]=_=>{t.construction_type_id=_.construction_type_id,t.category_id=_.category_id,t.sub_category_id=_.sub_category_id})},null,8,["construction-types","model-value","errors"]),t.category_id==="2"?(p(),O(me,{key:0,form:t,errors:o.value,"measurement-units":u.measurementUnits,"sub-categories":W.value},null,8,["form","errors","measurement-units","sub-categories"])):(p(),O(fe,{key:1,form:t,errors:o.value,"measurement-units":u.measurementUnits,condition:{constructionTypeId:"1",categoryId:"1",subCategoryId:"1"}},null,8,["form","errors","measurement-units"]))])):$("",!0),n.value===3?(p(),y("div",Ce,[h(pe,{form:t,errors:o.value,amenities:u.amenities,"measurement-units":u.measurementUnits},null,8,["form","errors","amenities","measurement-units"])])):$("",!0),s("div",ze,[n.value>1?(p(),y("button",{key:0,type:"button",onClick:M,class:"btn btn-secondary btn-sm btn-previous"}," Previous ")):$("",!0),s("button",{type:"button",onClick:I,class:"btn btn-primary btn-sm btn-primary-custom",disabled:j.value},F(j.value?"Processing...":n.value===3?"Create Project":"Next"),9,Te)])],32)])])],512),[[ie,!T.value]])])])])]),v.value.show?(p(),y("div",{key:0,class:ae(["toast-notification",v.value.type==="success"?"toast-success":"toast-error"]),style:{position:"fixed",top:"20px",right:"20px","z-index":"9999","min-width":"300px",padding:"12px 16px","border-radius":"8px",color:"white","font-weight":"500","box-shadow":"0 4px 12px rgba(0,0,0,0.15)"}},[s("div",Fe,[s("span",Ae,F(v.value.type==="success"?"✅":"❌"),1),s("span",null,F(v.value.message),1)])],2)):$("",!0)]),_:1},8,["breadcrumbs"])],64))}}),Je=oe(Ne,[["__scopeId","data-v-ac33e10e"]]);export{Je as default};
